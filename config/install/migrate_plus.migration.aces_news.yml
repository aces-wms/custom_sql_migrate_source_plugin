id: aces_news
label: Migrate News from Drupal 8 to Drupal 9
migration_group: aces_news
migration_dependencies: {}
dependencies:
  enforced:
    module:
      - aces_news_migration
source:
  plugin: custom_sql_query
  key: migrate
  keys:
    - nid
  sql_query: "SELECT ln.nid, ln.type, fd.title, nb.body_value, nb.body_summary, nb.body_format, fa.field_news_author_ref_target_id, ea.field_author_email_address_value FROM node ln LEFT JOIN node_field_data fd ON ln.nid = fd.nid INNER JOIN node__body nb ON ln.nid = nb.entity_id INNER JOIN node__field_news_author_ref fa ON ln.nid = fa.entity_id INNER JOIN node__field_author_email_address ea ON ea.entity_id = fa.field_news_author_ref_target_id WHERE ln.type='news' ORDER BY ln.nid ASC"
process:
  title: title
  'body/value': body_value
  'body/summary': body_summary
  'body/format':
    plugin: default_value
    default_value: 'basic_html'
  field_if_author:
    plugin: get
    source: author
    'body/value': text
    'body/summary': summary
    'body/format':
      plugin: default_value
      default_value: 'basic_html'
  uid_input:
    -
      plugin: explode
      delimiter: '@'
      source: field_author_email_address_value
      limit: 2
  uid:
    plugin: entity_generate
    source: '@uid_input'
    value_key: name
    entity_type: user
    ignore_case: true
    mail: field_author_email_address_value
destination:
  plugin: entity:node
  default_bundle: news
#  created:
#    plugin: format_date
#    from_format: 'U'
#    to_format: 'U'
#    source: fd.created
#  changed:
#    plugin: format_date
#    from_format: 'U'
#    to_format: 'U'
#    source: fd.changed
#  status:
#    plugin: get
#    source: fd.status
#  nid:
#    plugin: default_value
#    default_value: news

#  field_tags:
#    - plugin: skip_on_empty
#      source: news_category
#      method: process
#      message: 'No categories listed.'
#    - plugin: explode
#      delimiter: '	'
#    - plugin: entity_generate
#      entity_type: taxonomy_term
#      bundle: tags
#      value_key: name
#  field_if_date:
#    plugin: format_date
#    from_format: 'U'
#    to_format: 'U'
#    source: fd.changed

